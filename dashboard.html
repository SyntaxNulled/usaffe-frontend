<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USAFFE Command Network</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Special+Elite&display=swap');
  </style>
</head>

<body class="bg-gray-900 text-white min-h-screen font-sans"
      style="background-image: url('http://static.photos/vintage/1200x630/42'); background-size: cover; background-attachment: fixed;">

  <!-- HEADER -->
  <div class="bg-gray-800 p-4 flex justify-between items-center border-b border-yellow-700 backdrop-blur-sm bg-opacity-90">
    <div class="flex items-center gap-4">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/United_States_Army_Air_Forces_emblem.svg/1200px-United_States_Army_Air_Forces_emblem.svg.png"
           class="w-12 h-12">
      <h1 class="text-2xl font-bold font-serif" style="font-family: 'Playfair Display', serif;">
        USAFFE COMMAND NETWORK
      </h1>
    </div>

    <div class="flex items-center gap-4">
      <span id="userDisplay" class="text-gray-300 font-mono">LOADING...</span>
      <img id="avatarImg" class="w-10 h-10 rounded border border-yellow-700" src="">
      <button onclick="logout()" class="text-red-400 hover:text-red-300 font-mono">SIGN OUT</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="max-w-4xl mx-auto p-6 backdrop-blur-sm bg-gray-900 bg-opacity-70 rounded-lg my-6 border border-yellow-700">

    <h2 class="text-xl font-semibold mb-4 font-mono" style="font-family: 'Special Elite', cursive;">
      AUTHORIZED ACCESS LEVEL
    </h2>

    <!-- Rank Card -->
    <div class="bg-gray-800 p-6 rounded-lg border border-yellow-700 mb-6">
      <p class="text-gray-300 mb-2 font-mono">CURRENT RANK:</p>
      <p id="rankDisplay" class="text-3xl font-bold text-yellow-400 font-serif">LOADING...</p>
    </div>

    <!-- NAVIGATION GRID -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

      <!-- Personnel File -->
      <a href="profile.html"
        class="bg-yellow-800 hover:bg-yellow-700 py-4 rounded-lg font-semibold flex items-center justify-center gap-2 border border-yellow-700 transition-all hover:scale-105">
        <i data-feather="user"></i> <span class="font-mono">PERSONNEL FILE</span>
      </a>

      <!-- Training Records -->
      <a href="trainings.html"
        class="bg-green-900 hover:bg-green-800 py-4 rounded-lg font-semibold flex items-center justify-center gap-2 border border-green-700 transition-all hover:scale-105">
        <i data-feather="book-open"></i> <span class="font-mono">TRAINING RECORDS</span>
      </a>

      <!-- Commendations -->
      <a href="medals.html"
        class="bg-red-900 hover:bg-red-800 py-4 rounded-lg font-semibold flex items-center justify-center gap-2 border border-red-700 transition-all hover:scale-105">
        <i data-feather="award"></i> <span class="font-mono">COMMENDATIONS</span>
      </a>

      <!-- Situation Report -->
      <a href="status.html"
        class="bg-blue-900 hover:bg-blue-800 py-4 rounded-lg font-semibold flex items-center justify-center gap-2 border border-blue-700 transition-all hover:scale-105">
        <i data-feather="activity"></i> <span class="font-mono">SITUATION REPORT</span>
      </a>

      <!-- Staff Panel -->
      <a id="staffBtn" href="staff.html"
        class="hidden bg-gray-700 hover:bg-gray-600 py-4 rounded-lg font-semibold flex items-center justify-center gap-2 border border-gray-600 transition-all hover:scale-105">
        <i data-feather="shield"></i> <span class="font-mono">COMMAND WAR ROOM</span>
      </a>

    </div>

  </div>

  <script>
const API = "https://usafe-staff-portal.onrender.com";

// Redirect if not logged in
const token = localStorage.getItem("usafe_token");
const robloxId = localStorage.getItem("usafe_roblox_id");
const username = localStorage.getItem("usafe_username");
const displayName = localStorage.getItem("usafe_display_name");

if (!token || !robloxId) {
  window.location.href = "login.html";
}

// Display user in header
document.getElementById("userDisplay").textContent =
  `${displayName.toUpperCase()} (@${username})`;

// Load avatar
async function loadAvatar() {
  try {
    const res = await fetch(
      `https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${robloxId}&size=150x150&format=Png&isCircular=false`
    );
    const data = await res.json();
    const url = data?.data?.[0]?.imageUrl;

    const avatarImg = document.getElementById("avatarImg");
    if (avatarImg) avatarImg.src = url || "";
  } catch (err) {
    console.warn("Avatar failed to load");
  }
}

// Load profile to determine rank + access
async function loadProfile() {
  try {
    const res = await fetch(`${API}/api/users/${robloxId}`);
    const data = await res.json();

    if (!res.ok) return;

    document.getElementById("rankDisplay").textContent =
      data.rank || "UNASSIGNED";

    // Officer ranks unlock staff panel
    const officerRanks = ["2LT", "1LT", "CPT", "MAJ", "LTC", "COL", "GEN"];
    if (officerRanks.includes(data.rank)) {
      document.getElementById("staffBtn").classList.remove("hidden");
    }

  } catch (err) {
    console.error(err);
  }
}

// Logout
function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}

// Run on page load
loadAvatar();
loadProfile();
feather.replace();
  </script>

</body>
</html>
