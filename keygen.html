<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>USAFE Admin Key Generator</title>
  <style>
    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .card {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 24px 32px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0,0,0,0.6);
    }
    h1 {
      margin-top: 0;
      font-size: 1.5rem;
      color: #f9fafb;
    }
    button {
      background: #16a34a;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      color: #f9fafb;
      cursor: pointer;
      font-weight: 600;
      margin-top: 1rem;
    }
    button:hover {
      background: #15803d;
    }
    .key-box {
      margin-top: 1rem;
      padding: 10px;
      background: #020617;
      border-radius: 6px;
      font-family: "JetBrains Mono", monospace;
      font-size: 0.9rem;
      word-break: break-all;
    }
    .small {
      font-size: 0.8rem;
      color: #9ca3af;
    }
    a {
      color: #38bdf8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>USAFE Admin Key Generator</h1>
    <p class="small">
      Generate a 12-hour admin key. Use this key on the admin site to log in.
    </p>
    <button id="generateBtn">Generate New Key</button>

    <div id="result" style="display:none;">
      <p class="small" style="margin-top:1rem;">Generated Key (valid for 12 hours):</p>
      <div class="key-box" id="keyBox"></div>
      <p class="small" id="expiryText"></p>

      <button id="copyBtn">Copy Key</button>

      <p class="small" style="margin-top:1rem;">
        After copying, go to:
        <br />
        <a href="https://usaffe-frontend.pages.dev/admin/abcdef" target="_blank">
          https://usaffe-frontend.pages.dev/admin/&lt;any-hex-here&gt;
        </a>
        <br />
        and paste the key into the login field.
      </p>
    </div>

    <p id="error" class="small" style="color:#f97373;margin-top:1rem;"></p>
  </div>

  <script>
    const API = 'https://usafe-backend.onrender.com';

    const generateBtn = document.getElementById('generateBtn');
    const copyBtn = document.getElementById('copyBtn');
    const resultDiv = document.getElementById('result');
    const keyBox = document.getElementById('keyBox');
    const expiryText = document.getElementById('expiryText');
    const errorEl = document.getElementById('error');

    generateBtn.addEventListener('click', async () => {
      errorEl.textContent = '';
      resultDiv.style.display = 'none';

      try {
        const res = await fetch(`${API}/api/admin-keys/create`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({})
        });

        const data = await res.json();
        if (!res.ok) {
          errorEl.textContent = data.error || 'Failed to generate key.';
          return;
        }

        keyBox.textContent = data.key;
        expiryText.textContent = `Expires at: ${new Date(data.expires_at).toLocaleString()}`;
        resultDiv.style.display = 'block';
      } catch (err) {
        console.error(err);
        errorEl.textContent = 'Network error.';
      }
    });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(keyBox.textContent);
        alert('Key copied to clipboard. Go to the admin page and paste it.');
        // Optional: open admin page automatically
        window.open('https://usaffe-frontend.pages.dev/admin/abcdef', '_blank');
      } catch (err) {
        alert('Failed to copy key. Copy it manually.');
      }
    });
  </script>
</body>
</html>
